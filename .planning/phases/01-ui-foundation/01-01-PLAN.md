---
phase: 01-ui-foundation
plan: 01
type: execute
---

<objective>
Set up planning workflow UI framework with phase navigation system.

Purpose: Create the foundation for the documentation-first planning UI by extending the existing web dashboard with a guided SDLC workflow interface. This establishes the core structure that subsequent phases will build upon.

Output: Working `/planning` route with phase navigation, state tracking, and hard gate enforcement preventing users from skipping planning steps.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

**Codebase constraints from mapping:**
@.planning/codebase/STACK.md
@.planning/codebase/ARCHITECTURE.md
@.planning/codebase/CONVENTIONS.md
@.planning/codebase/STRUCTURE.md

**Technologies that must be used:**
- TypeScript 5.7.2 with strict mode
- Hono v4.6.14 web framework
- Existing glassmorphic UI patterns from public/index.html
- No external UI libraries (vanilla HTML/CSS/JS)

**Patterns that must be followed:**
- File naming: kebab-case.ts for TypeScript files
- Function naming: camelCase
- Type naming: PascalCase for interfaces
- API responses: `{ success: boolean, data?: T, error?: string }`
- Zod schemas for request validation
- 2 spaces indentation, no trailing semicolons

**Existing UI patterns to reuse (from public/index.html):**
- Glassmorphic cards: `var(--card-bg)` with `backdrop-filter: blur(var(--glass-blur))`
- Form inputs: `.input-group` with labels and styled inputs
- Buttons: `.btn` with gradient backgrounds and hover effects
- Progress indicators: Grid-based with status badges
- Color scheme: `var(--primary)`, `var(--secondary)`, `var(--accent)`, `var(--bg)`

**Prior decisions affecting this phase:**
- Extend existing web dashboard (leverage current Hono server, don't build standalone)
- Hard gates to enforce workflow discipline (cannot skip phases)
- File-based output to disk (aligns with Claude Code CLI workflow)
- Browser-based interface only (no desktop app)

**Phase navigation structure (from PROJECT.md):**
- Phase 1: Requirements gathering (PRD generation)
- Phase 2: Design documentation (Technical spec, ADRs)
- Phase 3: Implementation planning (Task breakdown, file plan)

**Constraints:**
- Single user only (no multi-user features)
- No authentication (local/trusted environment)
- Must integrate with existing SDLC orchestrator patterns in src/sdlc/
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create planning workflow API route</name>
  <files>src/api/server.ts</files>
  <action>
Add new route `GET /planning` to serve the planning workflow UI. Create a new HTML template similar to public/index.html but focused on the guided workflow interface. Serve it using `c.html()` from Hono context. Use the same CSS variables and glassmorphic design patterns from the existing dashboard.

Add routes:
- `GET /planning` - Serve planning UI HTML
- `POST /api/planning/initialize` - Initialize new planning session (create session state)
- `GET /api/planning/state` - Get current planning session state (current phase, completions)
- `POST /api/planning/phase/:phaseId/complete` - Mark phase as complete and unlock next phase

Zod schemas for validation:
- InitializePlanningSchema: `{ projectName: z.string().min(1), description: z.string().optional() }`
- CompletePhaseSchema: `{ phaseId: z.enum(['requirements', 'design', 'implementation']), output: z.any() }`

Return format: Standard `{ success: boolean, data?: T, error?: string }` pattern used in existing endpoints.

Note: For now, use in-memory storage for planning session state (Map structure like existing SDLC projects). Avoid adding database dependency - keep it simple and consistent with current architecture.
  </action>
  <verify>
- `npm run build` succeeds without TypeScript errors
- curl http://localhost:3000/planning returns HTML with 200 status
- curl -X POST http://localhost:3000/api/planning/initialize -d '{"projectName":"test"}' returns success response
  </verify>
  <done>Planning routes exist in server.ts, Zod schemas defined, TypeScript compiles without errors, endpoints return correct response structure</done>
</task>

<task type="auto">
  <name>Task 2: Build phase navigation UI component</name>
  <files>src/api/server.ts (inline HTML template)</files>
  <action>
Create the planning workflow HTML template within the `/planning` route handler. Structure:

**Layout:**
- Header: "Documentation-First Planning" title with subtitle
- Phase navigation: Horizontal stepper showing Requirements → Design → Implementation
- Current phase card: Display active phase with description and form/input area
- Navigation buttons: "Continue" (disabled until phase complete) and "Save Progress"

**Phase stepper visual:**
- Each phase shown as circle with connecting line
- States: completed (green checkmark), active (highlighted), locked (gray)
- Use grid layout for responsive design (mobile stacks vertically)

**State management (vanilla JS):**
- Fetch planning state from `/api/planning/state` on page load
- Track currentPhase, completedPhases array
- Update UI to show which phases are locked/unlocked
- Disable "Continue" button if current phase not completed
- Show visual indicators (checkmarks, locks) based on state

**Styling:**
Reuse existing patterns from public/index.html:
- Same CSS variables (`--primary`, `--card-bg`, etc.)
- Glassmorphic cards for phase content
- Same button styles (`.btn` class)
- Same form input styles (`.input-group` pattern)
- Mobile-responsive grid (same approach as existing dashboard)

**Hard gate enforcement:**
- JavaScript prevents clicking locked phases
- "Continue" button only enabled when currentPhase has required data
- Visual feedback when trying to access locked phases (tooltip or alert)

Don't overcomplicate - keep it simple HTML/CSS/JS following existing dashboard patterns. No frameworks needed.
  </action>
  <verify>
- Open http://localhost:3000/planning in browser
- Phase navigation displays 3 phases horizontally
- Only phase 1 (Requirements) is unlocked initially
- Clicking locked phases shows visual feedback (disabled state)
- Page uses same color scheme and glassmorphic style as main dashboard
  </verify>
  <done>Planning UI loads with phase navigation, hard gates visually enforce phase order, styling matches existing dashboard, responsive design works</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Planning workflow UI at /planning with phase navigation and hard gate enforcement</what-built>
  <how-to-verify>
1. Run: npm run dev (or npm start if server already built)
2. Visit: http://localhost:3000/planning
3. Desktop view: Verify horizontal phase stepper shows Requirements → Design → Implementation
4. Mobile view (375px): Verify phases stack vertically, still readable
5. Check phase states:
   - Phase 1 (Requirements): Unlocked, active
   - Phase 2 (Design): Locked, grayed out
   - Phase 3 (Implementation): Locked, grayed out
6. Try clicking locked phases: Should show disabled state, not navigate
7. Visual consistency: Matches glassmorphic style from main dashboard (same colors, blur effects, shadows)
8. No console errors in browser DevTools
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

<task type="auto">
  <name>Task 3: Add planning session state management</name>
  <files>src/sdlc/types.ts, src/api/server.ts</files>
  <action>
**Add types to src/sdlc/types.ts:**

```typescript
export interface PlanningSession {
  id: string;
  projectName: string;
  description?: string;
  currentPhase: 'requirements' | 'design' | 'implementation';
  completedPhases: string[];
  phaseData: {
    requirements?: any;
    design?: any;
    implementation?: any;
  };
  createdAt: Date;
  updatedAt: Date;
}

export interface PlanningPhaseDefinition {
  id: string;
  name: string;
  description: string;
  order: number;
  requiredFields: string[];
}
```

**Update src/api/server.ts with state management:**

Add in-memory Map storage:
```typescript
const planningSessions = new Map<string, PlanningSession>();
```

Implement routes:
- `POST /api/planning/initialize`: Create new session with unique ID, set currentPhase='requirements', empty completedPhases
- `GET /api/planning/state`: Return current session (for now, single session - get first/only session from Map)
- `POST /api/planning/phase/:phaseId/complete`:
  - Validate phaseId matches currentPhase
  - Store phaseData
  - Add phaseId to completedPhases
  - Set currentPhase to next phase in sequence
  - Return updated session state

**Phase transition logic:**
Requirements → Design → Implementation → done

**Validation rules:**
- Cannot complete phase out of order
- Cannot skip phases
- Return error if trying to complete phase that isn't current

Use existing error handling patterns from server.ts (try-catch, return { success: false, error: message }).
  </action>
  <verify>
- TypeScript compiles without errors
- POST /api/planning/initialize creates session and returns ID
- GET /api/planning/state returns session with currentPhase='requirements'
- POST /api/planning/phase/requirements/complete advances to 'design' phase
- POST /api/planning/phase/design/complete (before requirements) returns error
  </verify>
  <done>PlanningSession types exist, in-memory state storage works, API routes enforce phase order, phase completion advances workflow correctly</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `npm run build` succeeds without errors
- [ ] `npm run dev` starts server without crashes
- [ ] `/planning` route serves UI with phase navigation
- [ ] Phase gates visually enforce order (locked phases are disabled)
- [ ] API routes return correct session state
- [ ] Phase completion correctly advances workflow
- [ ] No TypeScript errors or warnings
- [ ] UI matches existing dashboard aesthetic (glassmorphic style)
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Planning workflow UI accessible at /planning
- Phase navigation displays with hard gates enforced
- API routes manage planning session state correctly
- Cannot skip phases or access locked content
- Styling consistent with existing dashboard
- TypeScript strict mode passes
- No runtime errors in browser console
</success_criteria>

<output>
After completion, create `.planning/phases/01-ui-foundation/01-01-SUMMARY.md`:

# Phase 1 Plan 1: UI Foundation Summary

**Foundation UI with phase navigation and hard gate enforcement - planning workflow operational.**

## Accomplishments

- Created `/planning` route serving guided workflow interface
- Built phase navigation UI showing Requirements → Design → Implementation
- Implemented hard gate enforcement preventing phase skipping
- Added planning session state management with in-memory storage
- Extended existing Hono API with planning-specific routes

## Files Created/Modified

- `src/api/server.ts` - Added /planning routes and inline HTML template for workflow UI
- `src/sdlc/types.ts` - Added PlanningSession and PlanningPhaseDefinition types

## Decisions Made

- Used in-memory Map storage for planning sessions (consistent with existing SDLC project storage)
- Embedded planning UI HTML template in server.ts route handler (following existing pattern from /route endpoint)
- Reused existing glassmorphic UI patterns from public/index.html (no new CSS framework)
- Implemented hard gates in JavaScript (visual + API validation)

## Issues Encountered

[Document any issues and resolutions, or "None"]

## Next Step

Ready for Phase 2: Requirements Phase UI - Build guided PRD generation interface
</output>
