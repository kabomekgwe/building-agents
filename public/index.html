<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Multi-Agent System Dashboard</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 2rem;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    .header {
      text-align: center;
      color: white;
      margin-bottom: 3rem;
    }

    .header h1 {
      font-size: 2.5rem;
      margin-bottom: 0.5rem;
    }

    .header p {
      font-size: 1.1rem;
      opacity: 0.9;
    }

    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    .stat-card {
      background: white;
      padding: 1.5rem;
      border-radius: 12px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .stat-card h3 {
      font-size: 0.875rem;
      color: #6b7280;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 0.5rem;
    }

    .stat-card .value {
      font-size: 2rem;
      font-weight: bold;
      color: #667eea;
    }

    .card {
      background: white;
      border-radius: 12px;
      padding: 2rem;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      margin-bottom: 2rem;
    }

    .card h2 {
      font-size: 1.5rem;
      margin-bottom: 1.5rem;
      color: #1f2937;
    }

    .input-group {
      margin-bottom: 1.5rem;
    }

    .input-group label {
      display: block;
      font-weight: 500;
      margin-bottom: 0.5rem;
      color: #374151;
    }

    .input-group input,
    .input-group textarea {
      width: 100%;
      padding: 0.75rem 1rem;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      font-size: 1rem;
      transition: border-color 0.2s;
    }

    .input-group input:focus,
    .input-group textarea:focus {
      outline: none;
      border-color: #667eea;
    }

    .input-group textarea {
      resize: vertical;
      min-height: 100px;
    }

    .btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 0.875rem 2rem;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
    }

    .btn:active {
      transform: translateY(0);
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .result {
      margin-top: 1.5rem;
      padding: 1.5rem;
      background: #f9fafb;
      border-radius: 8px;
      border-left: 4px solid #667eea;
    }

    .result.error {
      border-left-color: #ef4444;
      background: #fef2f2;
    }

    .result h3 {
      font-size: 1.125rem;
      margin-bottom: 1rem;
      color: #1f2937;
    }

    .result-field {
      margin-bottom: 0.75rem;
    }

    .result-field strong {
      color: #6b7280;
      display: inline-block;
      width: 120px;
    }

    .result-field span {
      color: #1f2937;
    }

    .confidence {
      display: inline-block;
      padding: 0.25rem 0.75rem;
      border-radius: 12px;
      font-weight: 600;
      font-size: 0.875rem;
    }

    .confidence.high {
      background: #d1fae5;
      color: #065f46;
    }

    .confidence.medium {
      background: #fef3c7;
      color: #92400e;
    }

    .confidence.low {
      background: #fee2e2;
      color: #991b1b;
    }

    .loading {
      text-align: center;
      padding: 2rem;
      color: #6b7280;
    }

    .domains-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 1rem;
    }

    .domain-card {
      padding: 1rem;
      background: #f9fafb;
      border-radius: 8px;
      border-left: 4px solid #667eea;
    }

    .domain-card h4 {
      font-size: 1rem;
      margin-bottom: 0.5rem;
      color: #1f2937;
      text-transform: capitalize;
    }

    .domain-card .count {
      font-size: 0.875rem;
      color: #6b7280;
    }

    .agent-list {
      margin-top: 0.75rem;
      list-style: none;
    }

    .agent-list li {
      padding: 0.5rem;
      margin-bottom: 0.25rem;
      background: white;
      border-radius: 4px;
      font-size: 0.875rem;
      color: #374151;
    }

    footer {
      text-align: center;
      color: white;
      margin-top: 3rem;
      opacity: 0.9;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ü§ñ Multi-Agent System</h1>
      <p>46-Agent Orchestration System | Version 2.0.0</p>
    </div>

    <div class="stats" id="stats">
      <div class="stat-card">
        <h3>Total Agents</h3>
        <div class="value">-</div>
      </div>
      <div class="stat-card">
        <h3>Domains</h3>
        <div class="value">-</div>
      </div>
      <div class="stat-card">
        <h3>Routing Accuracy</h3>
        <div class="value">100%</div>
      </div>
      <div class="stat-card">
        <h3>Avg Confidence</h3>
        <div class="value">-</div>
      </div>
    </div>

    <div class="card">
      <h2>üéØ Route Request</h2>
      <form id="routeForm">
        <div class="input-group">
          <label for="request">Describe your task:</label>
          <textarea
            id="request"
            name="request"
            placeholder="Example: Build a React button component with primary and secondary variants"
            required
          ></textarea>
        </div>
        <button type="submit" class="btn">Find Agent</button>
      </form>
      <div id="routeResult"></div>
    </div>

    <div class="card">
      <h2>üìä System Overview</h2>
      <div id="domains" class="domains-grid">
        <div class="loading">Loading domains...</div>
      </div>
    </div>

    <footer>
      <p>Built with Claude Code | Production-Ready | Test Coverage: 318+ tests</p>
    </footer>
  </div>

  <script>
    const API_BASE = '/api';

    // Safely create element with text content
    function createElement(tag, className, textContent) {
      const el = document.createElement(tag);
      if (className) el.className = className;
      if (textContent) el.textContent = textContent;
      return el;
    }

    // Load stats on page load
    async function loadStats() {
      try {
        const response = await fetch(`${API_BASE}/stats`);
        const data = await response.json();

        if (data.success) {
          const stats = data.data;
          const statCards = document.querySelectorAll('.stat-card .value');
          statCards[0].textContent = stats.totalAgents;
          statCards[1].textContent = stats.domains;
        }
      } catch (error) {
        console.error('Failed to load stats:', error);
      }
    }

    // Load domains
    async function loadDomains() {
      try {
        const response = await fetch(`${API_BASE}/domains`);
        const data = await response.json();

        if (data.success) {
          const domainsContainer = document.getElementById('domains');
          domainsContainer.textContent = ''; // Clear loading message

          for (const domain of data.data) {
            const agentsResponse = await fetch(`${API_BASE}/agents?domain=${domain.name}`);
            const agentsData = await agentsResponse.json();

            const domainCard = createElement('div', 'domain-card');

            const title = createElement('h4', null, domain.name);
            const count = createElement('div', 'count', `${domain.agentCount} agents`);
            const agentList = createElement('ul', 'agent-list');

            agentsData.data.slice(0, 5).forEach(agent => {
              const li = createElement('li', null, agent.name);
              agentList.appendChild(li);
            });

            if (agentsData.data.length > 5) {
              const moreLi = createElement('li', null, `+ ${agentsData.data.length - 5} more`);
              moreLi.style.color = '#6b7280';
              agentList.appendChild(moreLi);
            }

            domainCard.appendChild(title);
            domainCard.appendChild(count);
            domainCard.appendChild(agentList);
            domainsContainer.appendChild(domainCard);
          }
        }
      } catch (error) {
        console.error('Failed to load domains:', error);
        const domainsContainer = document.getElementById('domains');
        domainsContainer.textContent = '';
        const errorDiv = createElement('div', 'loading', 'Failed to load domains');
        errorDiv.style.color = '#ef4444';
        domainsContainer.appendChild(errorDiv);
      }
    }

    // Route request
    document.getElementById('routeForm').addEventListener('submit', async (e) => {
      e.preventDefault();

      const request = document.getElementById('request').value;
      const submitBtn = e.target.querySelector('button[type="submit"]');
      const resultContainer = document.getElementById('routeResult');

      submitBtn.disabled = true;
      submitBtn.textContent = 'Finding agent...';
      resultContainer.textContent = '';
      const loadingDiv = createElement('div', 'loading', 'Analyzing request...');
      resultContainer.appendChild(loadingDiv);

      try {
        const response = await fetch(`${API_BASE}/route`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ request, verbose: true })
        });

        const data = await response.json();
        resultContainer.textContent = '';

        if (data.success) {
          const result = data.data;
          const confidenceClass = result.confidence >= 70 ? 'high' : result.confidence >= 50 ? 'medium' : 'low';

          const resultDiv = createElement('div', 'result');
          const title = createElement('h3', null, '‚úÖ Routing Result');
          resultDiv.appendChild(title);

          // Domain field
          const domainField = createElement('div', 'result-field');
          domainField.appendChild(createElement('strong', null, 'Domain:'));
          domainField.appendChild(document.createTextNode(' '));
          domainField.appendChild(createElement('span', null, result.domain));
          resultDiv.appendChild(domainField);

          // Agent field
          const agentField = createElement('div', 'result-field');
          agentField.appendChild(createElement('strong', null, 'Agent:'));
          agentField.appendChild(document.createTextNode(' '));
          agentField.appendChild(createElement('span', null, result.agent));
          resultDiv.appendChild(agentField);

          // Confidence field
          const confidenceField = createElement('div', 'result-field');
          confidenceField.appendChild(createElement('strong', null, 'Confidence:'));
          confidenceField.appendChild(document.createTextNode(' '));
          const confidenceBadge = createElement('span', `confidence ${confidenceClass}`, `${result.confidence}%`);
          confidenceField.appendChild(confidenceBadge);
          resultDiv.appendChild(confidenceField);

          // Keywords field
          const keywordsField = createElement('div', 'result-field');
          keywordsField.appendChild(createElement('strong', null, 'Keywords:'));
          keywordsField.appendChild(document.createTextNode(' '));
          keywordsField.appendChild(createElement('span', null, result.keywords.join(', ')));
          resultDiv.appendChild(keywordsField);

          // Reasoning field
          const reasoningField = createElement('div', 'result-field');
          reasoningField.style.marginTop = '1rem';
          reasoningField.appendChild(createElement('strong', null, 'Reasoning:'));
          const reasoningDiv = createElement('div', null, result.reasoning);
          reasoningDiv.style.marginTop = '0.5rem';
          reasoningDiv.style.color = '#6b7280';
          reasoningDiv.style.fontSize = '0.875rem';
          reasoningField.appendChild(reasoningDiv);
          resultDiv.appendChild(reasoningField);

          resultContainer.appendChild(resultDiv);
        } else {
          throw new Error(data.error || 'Routing failed');
        }
      } catch (error) {
        resultContainer.textContent = '';
        const errorDiv = createElement('div', 'result error');
        errorDiv.appendChild(createElement('h3', null, '‚ùå Error'));
        errorDiv.appendChild(createElement('p', null, error.message));
        resultContainer.appendChild(errorDiv);
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = 'Find Agent';
      }
    });

    // Initialize
    loadStats();
    loadDomains();
  </script>
</body>
</html>
